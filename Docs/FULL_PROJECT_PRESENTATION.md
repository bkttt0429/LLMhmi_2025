# 專案技術報告：LLM-HMI 機器人控制系統 (10分鐘演示版本)

**報告主題:** 跨平台低延遲機器人 HMI 系統架構與技術優化  
**彙整人:** Antigravity AI  
**時間:** 2025-12-19  

---

## ⏱️ 報告流程配置 (10分鐘)
1.  **專案背景與整體架構 (2分鐘)**
2.  **韌體分段：底層控制與物理保護 (3分鐘)**
3.  **PC 客戶端：中樞調度與 AI 整合 (3分鐘)**
4.  **瀏覽器終端：數位雙生與 HMI 交互 (2分鐘)**

---

## 1️⃣ 整體專案概觀 (00:00 - 02:00)
### 1.1 核心目標
本專案開發了一套基於雙晶片架構（ESP32-S3 + ESP8266/ESP12F）的機器人控制系統。解決了遠端無線操控中常見的**高延遲**、**畫面掉幀**以及**系統不穩定**等核心痛點。

### 1.2 雙鏈路架構 (Dual-Link Architecture)
-   **控制鏈路 (Control Link):** 由 ESP12F 負責，專注於馬達 PWM 驅動、超聲波雷達監測。
-   **影像鏈路 (Video Link):** 由 ESP32-S3 (N16R8) 負責，處理高性能 MJPEG 串流與 PSRAM 影像緩衝。

---

## 2️⃣ 韌體分段：技術優化深度解析 (02:00 - 05:00)
> 此區塊為技術核心，展示已完成的關鍵優化。

### 2.1 控制流延遲優化 (Low-Latency Control)
*   **Wi-Fi Modem-Sleep 關閉**: 以前指令反應不穩定，我們強制禁用了 WiFi 的自動節電機制 (`WIFI_PS_NONE`)，將指令抖動 (Jitter) 從 200ms 降低至恆定的 10ms。
*   **UDP 協議升級**: 捨棄 HTTP API，改用二進位 UDP 二次封裝協議，實現「指令即發、硬體即動」。

### 2.2 物理層保護：軟啟動 (Soft-Start Acceleration)
*   **問題**: 大電流啟動馬達時，Wi-Fi 模組常因電壓驟降 (Brownout) 斷連。
*   **解決方案**: 在 `app_motor.c` 實作硬體級加速度斜坡 (Symmetry Acceleration Curve)。
*   **成效**: 即使在電池效能下降時，馬達仍能平滑加速，保護電源管理電路。

### 2.3 影像端（ESP32-S3）極限激發
*   **PSRAM 深度利用**: 針對 N16R8 模組，我們將 `fb_count` 從 3 增加至 5，利用 8MB Octal PSRAM 緩衝網路網路波動。
*   **動態重試機制**: 解決了冷啟動時攝像頭初始化失敗的 Hard-reset Bug。

---

## 3️⃣ PC 客戶端：中樞調度的技術深度 (05:00 - 08:00)
> 介紹 Python 中間層如何整合 AI 與 雙網卡路由。

### 3.1 雙網卡自動路由 (Dual-NIC Routing)
*   **技術實現**: 自動偵測本地網卡，將「影像流量」與「公網數據流量」實體隔離，防止影像串流佔滿頻寬導致操作卡頓。
*   **Socket 綁定**: 利用 `SourceAddressAdapter` 直接強制底層流量流向 192.168.4.x (Camera) 網段。

### 3.2 AI 偵測與多進程處理
*   **YOLOv13-Nano 集成**: 在 `ai_detector.py` 中實作。為了效能，我們使用了高效的影像佇列 (`Multiprocessing Queue`)。
*   **幀處理優化**: 影像偵測不在 Flask 主執行緒，而是在獨立進程執行，確保控制指令的傳輸優先權最高。

### 3.3 影像流管理 (VidGear/CamGear)
*   **優化點**: 使用 `VidGear` 取代原始 OpenCV 或 Requests 讀取流，這提供了強大的自動重連機制，當 ESP32 暫時重開時，PC Client 能在 1 秒內恢復畫面，無需人工干預。

---

## 4️⃣ 瀏覽器終端：數位雙生與 HMI (08:00 - 10:00)
> 強調操縱者的直覺感與沉浸式體驗。

### 4.1 數位雙生 (3D Kinematics)
*   **Three.js 聯動**: 網頁端不只是顯示畫面，還即時模擬機械手臂的 3D 模型。
*   **耦合補償邏輯**: 在前端實作 `q3_servo = q3_geom + (q2_geom - 90)`。這是一個數學上的優化，修正了機械手臂平行連桿的實體誤差。

### 4.2 模組化 HUD 與 WebSocket
*   **即時反饋**: 利用 Socket.io 異步推送超聲波雷達數據。
*   **UX 優化**: 支援 Xbox 搖桿透過 Web Gamepad API 直接控制，不需安裝驅動程式。

---

## 🚀 專案優化總結 (Key Highlights)
-   **控制響應性**: 從原本的延遲感明顯優化到了「手感一致」。
-   **系統健壯度**: 通過韌體端與 PC 端的雙重重連與保護機制，目前系統可支援長時間穩定運行。
-   **擴展性**: 全模組化設計，未來可隨時擴充語音控制 (LLM 語意解析) 或更高維度的視覺避障。

---
*本報告旨在展示開發過程中的技術精華與對極致性能的追求。*
